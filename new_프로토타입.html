<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서비스 신청 관리 시스템</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .service-card {
            transition: transform 0.2s;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        .task-badge {
            font-size: 0.75em;
            padding: 4px 8px;
        }
        .status-pending {
            background: linear-gradient(45deg, #ffc107, #ff8f00);
            color: white;
        }
        .status-reviewing {
            background: linear-gradient(45deg, #17a2b8, #138496);
            color: white;
        }
        .status-completed {
            background: linear-gradient(45deg, #28a745, #1e7e34);
            color: white;
        }
        .status-rejected {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-weight: 500;
        }
        .nav-tabs .nav-link.active {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border-radius: 25px;
        }
        .filter-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .task-item {
            border-left: 4px solid #007bff;
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .task-item:hover {
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .progress-bar-custom {
            height: 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- 헤더 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="text-primary mb-1">
                            <i class="fas fa-clipboard-list me-2"></i>서비스 신청 관리 시스템
                        </h2>
                        <p class="text-muted mb-0">내부 오퍼레이터용 대시보드</p>
                    </div>
                    <div class="d-flex align-items-center">
                        <span class="badge bg-success me-2">김오퍼레이터</span>
                        <button class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-cog me-1"></i>설정
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 통계 카드 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card service-card">
                    <div class="card-body text-center">
                        <i class="fas fa-clock text-warning fa-2x mb-2"></i>
                        <h5 class="card-title">대기중</h5>
                        <h3 class="text-warning" id="pendingCount">12</h3>
                        <small class="text-muted">검토 대기</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card service-card">
                    <div class="card-body text-center">
                        <i class="fas fa-eye text-info fa-2x mb-2"></i>
                        <h5 class="card-title">검토중</h5>
                        <h3 class="text-info" id="reviewingCount">5</h3>
                        <small class="text-muted">진행중</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card service-card">
                    <div class="card-body text-center">
                        <i class="fas fa-check-circle text-success fa-2x mb-2"></i>
                        <h5 class="card-title">완료</h5>
                        <h3 class="text-success" id="completedCount">28</h3>
                        <small class="text-muted">검토 완료</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card service-card">
                    <div class="card-body text-center">
                        <i class="fas fa-times-circle text-danger fa-2x mb-2"></i>
                        <h5 class="card-title">반려</h5>
                        <h3 class="text-danger" id="rejectedCount">3</h3>
                        <small class="text-muted">검토 반려</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- 탭 네비게이션 -->
        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab">
                    <i class="fas fa-list me-1"></i>전체 신청
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="passport-tab" data-bs-toggle="tab" data-bs-target="#passport" type="button" role="tab">
                    <i class="fas fa-passport me-1"></i>여권 검토
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="residence-tab" data-bs-toggle="tab" data-bs-target="#residence" type="button" role="tab">
                    <i class="fas fa-home me-1"></i>거주지 검토
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="registration-tab" data-bs-toggle="tab" data-bs-target="#registration" type="button" role="tab">
                    <i class="fas fa-id-card me-1"></i>등록증 검토
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="my-tasks-tab" data-bs-toggle="tab" data-bs-target="#my-tasks" type="button" role="tab">
                    <i class="fas fa-user-check me-1"></i>내 할당 목록
                </button>
            </li>
        </ul>

        <!-- 탭 콘텐츠 -->
        <div class="tab-content" id="mainTabsContent">
            <!-- 전체 신청 탭 -->
            <div class="tab-pane fade show active" id="all" role="tabpanel">
                <div class="filter-section">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <input type="text" class="form-control" id="searchAll" placeholder="신청자명, 대학교로 검색...">
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="statusFilterAll">
                                <option value="">전체 상태</option>
                                <option value="대기중">대기중</option>
                                <option value="검토중">검토중</option>
                                <option value="완료">완료</option>
                                <option value="반려">반려</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="serviceFilterAll">
                                <option value="">전체 서비스</option>
                                <option value="여권OCR">여권OCR</option>
                                <option value="거주지서류">거주지서류</option>
                                <option value="외국인등록증">외국인등록증</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-secondary w-100" onclick="resetFilters('all')">
                                <i class="fas fa-undo me-1"></i>초기화
                            </button>
                        </div>
                    </div>
                </div>
                <div id="allApplicationsList"></div>
            </div>

            <!-- 여권 검토 탭 -->
            <div class="tab-pane fade" id="passport" role="tabpanel">
                <div class="filter-section">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <input type="text" class="form-control" id="searchPassport" placeholder="신청자명으로 검색...">
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="statusFilterPassport">
                                <option value="">전체 상태</option>
                                <option value="대기중">대기중</option>
                                <option value="검토중">검토중</option>
                                <option value="완료">완료</option>
                                <option value="반려">반려</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-secondary w-100" onclick="resetFilters('passport')">
                                <i class="fas fa-undo me-1"></i>초기화
                            </button>
                        </div>
                    </div>
                </div>
                <div id="passportApplicationsList"></div>
            </div>

            <!-- 거주지 검토 탭 -->
            <div class="tab-pane fade" id="residence" role="tabpanel">
                <div class="filter-section">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <input type="text" class="form-control" id="searchResidence" placeholder="신청자명으로 검색...">
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="statusFilterResidence">
                                <option value="">전체 상태</option>
                                <option value="대기중">대기중</option>
                                <option value="검토중">검토중</option>
                                <option value="완료">완료</option>
                                <option value="반려">반려</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-secondary w-100" onclick="resetFilters('residence')">
                                <i class="fas fa-undo me-1"></i>초기화
                            </button>
                        </div>
                    </div>
                </div>
                <div id="residenceApplicationsList"></div>
            </div>

            <!-- 등록증 검토 탭 -->
            <div class="tab-pane fade" id="registration" role="tabpanel">
                <div class="filter-section">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <input type="text" class="form-control" id="searchRegistration" placeholder="신청자명으로 검색...">
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="statusFilterRegistration">
                                <option value="">전체 상태</option>
                                <option value="대기중">대기중</option>
                                <option value="검토중">검토중</option>
                                <option value="완료">완료</option>
                                <option value="반려">반려</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-secondary w-100" onclick="resetFilters('registration')">
                                <i class="fas fa-undo me-1"></i>초기화
                            </button>
                        </div>
                    </div>
                </div>
                <div id="registrationApplicationsList"></div>
            </div>

            <!-- 내 할당 목록 탭 -->
            <div class="tab-pane fade" id="my-tasks" role="tabpanel">
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-user-check me-2"></i>내 할당된 업무 목록
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <h4 class="text-warning">8</h4>
                                            <small class="text-muted">대기중</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <h4 class="text-info">3</h4>
                                            <small class="text-muted">진행중</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <h4 class="text-success">15</h4>
                                            <small class="text-muted">완료</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <h4 class="text-danger">2</h4>
                                            <small class="text-muted">반려</small>
                                        </div>
                                    </div>
                                </div>
                                <div id="myTasksList"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 업무 할당 모달 -->
    <div class="modal fade" id="assignTaskModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">업무 할당</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="assignTaskForm">
                        <div class="mb-3">
                            <label class="form-label">신청 정보</label>
                            <div class="alert alert-info" id="applicationInfo">
                                <!-- 신청 정보가 여기에 표시됩니다 -->
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">할당 대상</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="assignTarget" id="assignToMe" value="me" checked>
                                <label class="form-check-label" for="assignToMe">
                                    본인에게 할당
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="assignTarget" id="assignToOther" value="other">
                                <label class="form-check-label" for="assignToOther">
                                    다른 담당자에게 할당
                                </label>
                            </div>
                        </div>
                        <div class="mb-3" id="assigneeSelect" style="display: none;">
                            <label class="form-label">담당자 선택</label>
                            <select class="form-select" id="assignee">
                                <option value="">담당자를 선택하세요</option>
                                <option value="operator1">이오퍼레이터 (여권전문)</option>
                                <option value="operator2">박오퍼레이터 (거주지전문)</option>
                                <option value="operator3">최오퍼레이터 (등록증전문)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">우선순위</label>
                            <select class="form-select" id="priority">
                                <option value="low">낮음</option>
                                <option value="medium" selected>보통</option>
                                <option value="high">높음</option>
                                <option value="urgent">긴급</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">할당 메모</label>
                            <textarea class="form-control" id="assignMemo" rows="3" placeholder="업무 할당에 대한 메모를 입력하세요"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" onclick="confirmAssignTask()">할당하기</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 검토 진행 모달 -->
    <div class="modal fade" id="reviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">서류 검토</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>신청 정보</h6>
                            <div id="reviewApplicationInfo"></div>
                        </div>
                        <div class="col-md-6">
                            <h6>업로드된 서류</h6>
                            <div id="reviewDocuments"></div>
                        </div>
                    </div>
                    <hr>
                    <div class="mb-3">
                        <label class="form-label">검토 결과</label>
                        <select class="form-select" id="reviewResult">
                            <option value="approve">승인</option>
                            <option value="reject">반려</option>
                            <option value="request">보완요청</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">검토 의견</label>
                        <textarea class="form-control" id="reviewComment" rows="4" placeholder="검토 의견을 입력하세요"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-success" onclick="submitReview()">검토 완료</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 샘플 데이터
        let applications = [
            {
                id: "APP001",
                name: "장웨이",
                nationality: "중국",
                university: "서울대학교",
                service: "여권OCR",
                applyDate: "2024-01-15",
                status: "대기중",
                assignedTo: null,
                priority: "medium",
                documents: ["passport_front.jpg", "passport_back.jpg"],
                taskType: "여권 검토"
            },
            {
                id: "APP002",
                name: "김민수",
                nationality: "베트남",
                university: "연세대학교",
                service: "거주지서류",
                applyDate: "2024-01-14",
                status: "검토중",
                assignedTo: "김오퍼레이터",
                priority: "high",
                documents: ["residence_certificate.pdf", "utility_bill.pdf"],
                taskType: "거주지 검토"
            },
            {
                id: "APP003",
                name: "마리아",
                nationality: "필리핀",
                university: "고려대학교",
                service: "외국인등록증",
                applyDate: "2024-01-13",
                status: "완료",
                assignedTo: "김오퍼레이터",
                priority: "medium",
                documents: ["registration_card.jpg"],
                taskType: "등록증 검토"
            },
            {
                id: "APP004",
                name: "알리",
                nationality: "이란",
                university: "성균관대학교",
                service: "여권OCR",
                applyDate: "2024-01-12",
                status: "반려",
                assignedTo: "김오퍼레이터",
                priority: "low",
                documents: ["passport_damaged.jpg"],
                taskType: "여권 검토"
            },
            {
                id: "APP005",
                name: "사라",
                nationality: "미국",
                university: "한양대학교",
                service: "거주지서류",
                applyDate: "2024-01-11",
                status: "대기중",
                assignedTo: null,
                priority: "medium",
                documents: ["lease_agreement.pdf", "bank_statement.pdf"],
                taskType: "거주지 검토"
            }
        ];

        let currentOperator = "김오퍼레이터";

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            renderAllApplications();
            setupEventListeners();
            updateStatistics();
        });

        // 이벤트 리스너 설정
        function setupEventListeners() {
            // 검색 필터들
            const searchInputs = ['searchAll', 'searchPassport', 'searchResidence', 'searchRegistration'];
            const statusFilters = ['statusFilterAll', 'statusFilterPassport', 'statusFilterResidence', 'statusFilterRegistration'];
            const serviceFilters = ['serviceFilterAll'];

            searchInputs.forEach(id => {
                document.getElementById(id)?.addEventListener('input', filterApplications);
            });

            statusFilters.forEach(id => {
                document.getElementById(id)?.addEventListener('change', filterApplications);
            });

            serviceFilters.forEach(id => {
                document.getElementById(id)?.addEventListener('change', filterApplications);
            });

            // 할당 대상 라디오 버튼
            document.getElementById('assignToOther')?.addEventListener('change', function() {
                document.getElementById('assigneeSelect').style.display = this.checked ? 'block' : 'none';
            });

            // 탭 변경 이벤트
            document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(e) {
                    const target = e.target.getAttribute('data-bs-target');
                    switch(target) {
                        case '#all':
                            renderAllApplications();
                            break;
                        case '#passport':
                            renderServiceApplications('여권OCR');
                            break;
                        case '#residence':
                            renderServiceApplications('거주지서류');
                            break;
                        case '#registration':
                            renderServiceApplications('외국인등록증');
                            break;
                        case '#my-tasks':
                            renderMyTasks();
                            break;
                    }
                });
            });
        }

        // 전체 신청 렌더링
        function renderAllApplications() {
            const container = document.getElementById('allApplicationsList');
            renderApplicationList(container, applications);
        }

        // 서비스별 신청 렌더링
        function renderServiceApplications(service) {
            const filteredApps = applications.filter(app => app.service === service);
            let container;
            
            switch(service) {
                case '여권OCR':
                    container = document.getElementById('passportApplicationsList');
                    break;
                case '거주지서류':
                    container = document.getElementById('residenceApplicationsList');
                    break;
                case '외국인등록증':
                    container = document.getElementById('registrationApplicationsList');
                    break;
            }
            
            renderApplicationList(container, filteredApps);
        }

        // 내 할당 목록 렌더링
        function renderMyTasks() {
            const myTasks = applications.filter(app => app.assignedTo === currentOperator);
            const container = document.getElementById('myTasksList');
            
            if (myTasks.length === 0) {
                container.innerHTML = '<div class="alert alert-info">할당된 업무가 없습니다.</div>';
                return;
            }

            let html = '';
            myTasks.forEach(task => {
                html += `
                    <div class="task-item p-3">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <strong>${task.id}</strong>
                                <br><small class="text-muted">${task.name}</small>
                            </div>
                            <div class="col-md-2">
                                <span class="badge bg-info">${task.service}</span>
                                <br><small class="text-muted">${task.taskType}</small>
                            </div>
                            <div class="col-md-2">
                                <span class="badge ${getStatusBadgeClass(task.status)}">${task.status}</span>
                                <br><small class="text-muted">우선순위: ${getPriorityText(task.priority)}</small>
                            </div>
                            <div class="col-md-2">
                                ${task.applyDate}
                                <br><small class="text-muted">${task.university}</small>
                            </div>
                            <div class="col-md-2">
                                <div class="progress progress-bar-custom">
                                    <div class="progress-bar ${getProgressBarClass(task.status)}" 
                                         style="width: ${getProgressPercentage(task.status)}%"></div>
                                </div>
                                <small class="text-muted">진행률</small>
                            </div>
                            <div class="col-md-2 text-end">
                                ${task.status === '대기중' ? 
                                    `<button class="btn btn-primary btn-sm" onclick="startReview('${task.id}')">
                                        <i class="fas fa-play me-1"></i>검토 시작
                                    </button>` :
                                    task.status === '검토중' ?
                                    `<button class="btn btn-success btn-sm" onclick="openReviewModal('${task.id}')">
                                        <i class="fas fa-check me-1"></i>검토 완료
                                    </button>` :
                                    `<button class="btn btn-outline-secondary btn-sm" onclick="viewDetails('${task.id}')">
                                        <i class="fas fa-eye me-1"></i>상세보기
                                    </button>`
                                }
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // 신청 목록 렌더링 (공통)
        function renderApplicationList(container, apps) {
            if (apps.length === 0) {
                container.innerHTML = '<div class="alert alert-info">해당하는 신청이 없습니다.</div>';
                return;
            }

            let html = '';
            apps.forEach(app => {
                html += `
                    <div class="task-item p-3">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <strong>${app.id}</strong>
                                <br><small class="text-muted">${app.name} (${app.nationality})</small>
                            </div>
                            <div class="col-md-2">
                                <span class="badge bg-info">${app.service}</span>
                                <br><small class="text-muted">${app.taskType}</small>
                            </div>
                            <div class="col-md-2">
                                <span class="badge ${getStatusBadgeClass(app.status)}">${app.status}</span>
                                <br><small class="text-muted">${app.university}</small>
                            </div>
                            <div class="col-md-2">
                                ${app.applyDate}
                                <br><small class="text-muted">${app.documents.length}개 서류</small>
                            </div>
                            <div class="col-md-2">
                                ${app.assignedTo ? 
                                    `<span class="badge bg-success">${app.assignedTo}</span>` :
                                    `<span class="badge bg-warning">미할당</span>`
                                }
                                <br><small class="text-muted">${app.priority}</small>
                            </div>
                            <div class="col-md-2 text-end">
                                ${app.assignedTo === null ? 
                                    `<button class="btn btn-primary btn-sm" onclick="openAssignModal('${app.id}')">
                                        <i class="fas fa-user-plus me-1"></i>할당
                                    </button>` :
                                    app.assignedTo === currentOperator && app.status === '대기중' ?
                                    `<button class="btn btn-success btn-sm" onclick="startReview('${app.id}')">
                                        <i class="fas fa-play me-1"></i>검토 시작
                                    </button>` :
                                    `<button class="btn btn-outline-secondary btn-sm" onclick="viewDetails('${app.id}')">
                                        <i class="fas fa-eye me-1"></i>상세보기
                                    </button>`
                                }
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // 필터링 함수
        function filterApplications() {
            // 현재 활성 탭에 따라 필터링
            const activeTab = document.querySelector('.nav-link.active');
            const target = activeTab.getAttribute('data-bs-target');
            
            switch(target) {
                case '#all':
                    renderAllApplications();
                    break;
                case '#passport':
                    renderServiceApplications('여권OCR');
                    break;
                case '#residence':
                    renderServiceApplications('거주지서류');
                    break;
                case '#registration':
                    renderServiceApplications('외국인등록증');
                    break;
                case '#my-tasks':
                    renderMyTasks();
                    break;
            }
        }

        // 통계 업데이트
        function updateStatistics() {
            const pending = applications.filter(app => app.status === '대기중').length;
            const reviewing = applications.filter(app => app.status === '검토중').length;
            const completed = applications.filter(app => app.status === '완료').length;
            const rejected = applications.filter(app => app.status === '반려').length;

            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('reviewingCount').textContent = reviewing;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('rejectedCount').textContent = rejected;
        }

        // 상태별 배지 클래스
        function getStatusBadgeClass(status) {
            const classes = {
                '대기중': 'status-pending',
                '검토중': 'status-reviewing',
                '완료': 'status-completed',
                '반려': 'status-rejected'
            };
            return classes[status] || 'bg-secondary';
        }

        // 진행률 바 클래스
        function getProgressBarClass(status) {
            const classes = {
                '대기중': 'bg-warning',
                '검토중': 'bg-info',
                '완료': 'bg-success',
                '반려': 'bg-danger'
            };
            return classes[status] || 'bg-secondary';
        }

        // 진행률 퍼센트
        function getProgressPercentage(status) {
            const percentages = {
                '대기중': 25,
                '검토중': 75,
                '완료': 100,
                '반려': 100
            };
            return percentages[status] || 0;
        }

        // 우선순위 텍스트
        function getPriorityText(priority) {
            const texts = {
                'low': '낮음',
                'medium': '보통',
                'high': '높음',
                'urgent': '긴급'
            };
            return texts[priority] || '보통';
        }

        // 할당 모달 열기
        function openAssignModal(applicationId) {
            const app = applications.find(a => a.id === applicationId);
            if (!app) return;

            document.getElementById('applicationInfo').innerHTML = `
                <strong>${app.id}</strong> - ${app.name}<br>
                <small>${app.service} | ${app.university} | ${app.applyDate}</small>
            `;

            document.getElementById('assignTaskModal').setAttribute('data-application-id', applicationId);
            
            const modal = new bootstrap.Modal(document.getElementById('assignTaskModal'));
            modal.show();
        }

        // 할당 확인
        function confirmAssignTask() {
            const applicationId = document.getElementById('assignTaskModal').getAttribute('data-application-id');
            const assignTarget = document.querySelector('input[name="assignTarget"]:checked').value;
            const assignee = document.getElementById('assignee').value;
            const priority = document.getElementById('priority').value;
            const memo = document.getElementById('assignMemo').value;

            if (assignTarget === 'other' && !assignee) {
                alert('담당자를 선택해주세요.');
                return;
            }

            const app = applications.find(a => a.id === applicationId);
            if (app) {
                app.assignedTo = assignTarget === 'me' ? currentOperator : assignee;
                app.priority = priority;
                app.status = '대기중';
            }

            alert('업무가 성공적으로 할당되었습니다.');
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('assignTaskModal'));
            modal.hide();
            
            updateStatistics();
            filterApplications();
        }

        // 검토 시작
        function startReview(applicationId) {
            const app = applications.find(a => a.id === applicationId);
            if (app) {
                app.status = '검토중';
                updateStatistics();
                filterApplications();
                alert('검토를 시작합니다.');
            }
        }

        // 검토 모달 열기
        function openReviewModal(applicationId) {
            const app = applications.find(a => a.id === applicationId);
            if (!app) return;

            document.getElementById('reviewApplicationInfo').innerHTML = `
                <p><strong>신청번호:</strong> ${app.id}</p>
                <p><strong>신청자:</strong> ${app.name} (${app.nationality})</p>
                <p><strong>대학교:</strong> ${app.university}</p>
                <p><strong>서비스:</strong> ${app.service}</p>
                <p><strong>신청일:</strong> ${app.applyDate}</p>
            `;

            document.getElementById('reviewDocuments').innerHTML = app.documents.map(doc => 
                `<div class="mb-2">
                    <i class="fas fa-file me-2"></i>${doc}
                    <button class="btn btn-sm btn-outline-primary ms-2">보기</button>
                </div>`
            ).join('');

            document.getElementById('reviewModal').setAttribute('data-application-id', applicationId);
            
            const modal = new bootstrap.Modal(document.getElementById('reviewModal'));
            modal.show();
        }

        // 검토 제출
        function submitReview() {
            const applicationId = document.getElementById('reviewModal').getAttribute('data-application-id');
            const result = document.getElementById('reviewResult').value;
            const comment = document.getElementById('reviewComment').value;

            const app = applications.find(a => a.id === applicationId);
            if (app) {
                switch(result) {
                    case 'approve':
                        app.status = '완료';
                        break;
                    case 'reject':
                        app.status = '반려';
                        break;
                    case 'request':
                        app.status = '대기중';
                        break;
                }
            }

            alert('검토가 완료되었습니다.');
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('reviewModal'));
            modal.hide();
            
            updateStatistics();
            filterApplications();
        }

        // 상세보기
        function viewDetails(applicationId) {
            alert('상세보기 기능을 구현하세요.');
        }

        // 필터 초기화
        function resetFilters(tab) {
            const searchId = `search${tab.charAt(0).toUpperCase() + tab.slice(1)}`;
            const statusId = `statusFilter${tab.charAt(0).toUpperCase() + tab.slice(1)}`;
            const serviceId = `serviceFilter${tab.charAt(0).toUpperCase() + tab.slice(1)}`;

            if (document.getElementById(searchId)) document.getElementById(searchId).value = '';
            if (document.getElementById(statusId)) document.getElementById(statusId).value = '';
            if (document.getElementById(serviceId)) document.getElementById(serviceId).value = '';

            filterApplications();
        }
    </script>
</body>
</html> 