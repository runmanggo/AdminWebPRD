<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드 - 출입국 반려 관리</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Noto Sans KR -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #aab2bd; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #8892a1; }
        .submenu { display: none; overflow: hidden; transition: max-height 0.3s ease-in-out; max-height: 0; }
        .submenu.open { display: block; max-height: 500px; }
        .modal-backdrop { transition: opacity 0.3s ease; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="flex h-screen">
        <!-- Sidebar -->
    

        <!-- Main Content -->
        <main class="flex-1 overflow-auto p-6 sm:p-8">
            <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
                <h2 class="text-2xl font-bold">출입국 반려 관리</h2>
                <button id="open-new-rejection-modal" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 border rounded-md hover:bg-indigo-700">새 반려 사항 등록</button>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-sm">
                <div class="border rounded-md p-4 mb-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <input type="text" placeholder="학생 정보 검색" class="col-span-full w-full px-3 py-2 border border-slate-300 rounded-md">
                        <select class="rounded-md border-slate-300 shadow-sm text-sm"><option>대학교 전체</option></select>
                        <select class="rounded-md border-slate-300 shadow-sm text-sm"><option>부처 전체</option></select>
                        <select class="rounded-md border-slate-300 shadow-sm text-sm"><option>상태 전체</option><option>대기중</option><option>해결완료</option></select>
                    </div>
                </div>
                <div class="flex justify-end mb-4">
                    <button class="px-4 py-2 text-sm font-medium text-white bg-green-600 border rounded-md hover:bg-green-700">엑셀 다운로드</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-slate-500">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                            <tr>
                                <th class="p-4">AccountId</th>
                                <th class="p-4">이름</th>
                                <th class="p-4">이메일</th>
                                <th class="p-4">대학교</th>
                                <th class="p-4">부처</th>
                                <th class="p-4">사증 타입</th>
                                <th class="p-4">관련 서류</th>
                                <th class="p-4">반려 유형</th>
                                <th class="p-4">반려 사유</th>
                                <th class="p-4">등록일</th>
                                <th class="p-4">마감일</th>
                                <th class="p-4">상태</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            <tr>
                                <td class="p-4"><a href="user-detail.html?id=usr001" class="font-medium text-indigo-600 hover:underline">usr001</a></td>
                                <td class="p-4">김민수</td>
                                <td class="p-4">kim@example.com</td>
                                <td class="p-4">서울대학교</td>
                                <td class="p-4">국제협력본부</td>
                                <td class="p-4">D-2</td>
                                <td class="p-4">
                                    <div class="flex flex-wrap gap-1">
                                        <span class="px-2 py-0.5 text-xs bg-slate-100 rounded-full">여권</span>
                                        <span class="px-2 py-0.5 text-xs bg-slate-100 rounded-full">사증</span>
                                    </div>
                                </td>
                                <td class="p-4">서류 불일치</td>
                                <td class="p-4 text-xs">여권과 사증의 개인정보가 일치하지 않습니다.</td>
                                <td class="p-4">2024-07-08</td>
                                <td class="p-4">2024-07-15</td>
                                <td class="p-4"><span class="px-2 py-1 text-xs font-semibold text-orange-800 bg-orange-100 rounded-full">대기중</span></td>
                            </tr>
                            <tr>
                                <td class="p-4"><a href="user-detail.html?id=usr002" class="font-medium text-indigo-600 hover:underline">usr002</a></td>
                                <td class="p-4">박영희</td>
                                <td class="p-4">park@example.com</td>
                                <td class="p-4">고려대학교</td>
                                <td class="p-4">국제처</td>
                                <td class="p-4">D-4</td>
                                <td class="p-4">
                                    <span class="px-2 py-0.5 text-xs bg-slate-100 rounded-full">거주지 서류</span>
                                </td>
                                <td class="p-4">서류 미비</td>
                                <td class="p-4 text-xs">임대차 계약서와 임대인 신분증을 추가로 제출해주세요.</td>
                                <td class="p-4">2024-07-07</td>
                                <td class="p-4">2024-07-14</td>
                                <td class="p-4"><span class="px-2 py-1 text-xs font-semibold text-green-800 bg-green-100 rounded-full">해결완료</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    
    <!-- New Rejection Modal -->
    <div id="new-rejection-modal" class="fixed inset-0 bg-slate-900 bg-opacity-50 flex items-center justify-center p-4 z-50 hidden modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] flex flex-col">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold">새 반려 사항 등록</h3>
                <button data-close-modal="new-rejection-modal" class="text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
            </div>
            <div class="p-6 flex-1 overflow-y-auto">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Step 1: Select Student -->
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h3 class="text-lg font-bold mb-4">1. 학생 선택</h3>
                        <input type="text" placeholder="학생 이름, 이메일, 학번 등으로 검색" class="w-full p-2 border rounded-md mb-4">
                        <div id="student-list-modal" class="space-y-2 max-h-96 overflow-y-auto border rounded-md p-2 bg-white">
                            <!-- Student items will be populated by JS -->
                        </div>
                    </div>
                    <!-- Step 2: Select Documents -->
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h3 class="text-lg font-bold mb-2">2. 관련 서류 선택</h3>
                        <p class="text-sm text-slate-500 mb-4">반려와 관련된 서류를 모두 선택해주세요.</p>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">여권</span></label>
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">거주지 서류</span></label>
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">사증</span></label>
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">재학증명서</span></label>
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">등록금 납입 증명서</span></label>
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">증명사진</span></label>
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">서명</span></label>
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">장학증명서</span></label>
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">예치확인서</span></label>
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">건강진단서</span></label>
                            <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded"> <span class="ml-2">기타</span></label>
                        </div>
                    </div>
                    <!-- Step 3: Rejection Reason -->
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h3 class="text-lg font-bold mb-4">3. 반려 사유 입력</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="font-semibold block mb-1 text-sm">반려 유형을 선택하세요</label>
                                <select class="w-full p-2 border rounded-md"><option>서류 식별 불가</option><option>정보 불일치</option><option>유효기간 만료</option><option>기타</option></select>
                            </div>
                            <div>
                                <textarea placeholder="반려 사유를 구체적으로 입력하세요." class="w-full p-2 border rounded-md" rows="5"></textarea>
                            </div>
                            <div class="p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-800 text-sm">
                                💡 입력하신 내용은 학생에게 이메일과 시스템 알림으로 전송됩니다. 명확하고 구체적인 안내를 작성해주세요.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t flex justify-end gap-2 bg-slate-50 rounded-b-lg">
                <button data-close-modal="new-rejection-modal" class="px-4 py-2 bg-slate-200 rounded-md">취소</button>
                <button class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-md hover:bg-indigo-700">반려 사항 전송</button>
            </div>
        </div>
    </div>


    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Navigation Logic ---
            const navAccordions = document.querySelectorAll('.nav-accordion');
            navAccordions.forEach(accordion => { /* ... existing code ... */ });

            // --- Modal Logic ---
            const newRejectionModal = document.getElementById('new-rejection-modal');
            document.getElementById('open-new-rejection-modal').addEventListener('click', () => {
                newRejectionModal.classList.remove('hidden');
            });
            document.addEventListener('click', (e) => {
                if (e.target.dataset.closeModal) {
                    document.getElementById(e.target.dataset.closeModal).classList.add('hidden');
                }
                if (e.target === newRejectionModal) {
                    newRejectionModal.classList.add('hidden');
                }
            });

            // --- Student Selection Logic ---
            const mockStudents = [
                { id: 'usr001', name: '김민수', email: 'kim@example.com', university: '서울대학교', department: '국제협력본부', studentId: '2023001', visaType: 'D-2' },
                { id: 'usr002', name: '박영희', email: 'park@example.com', university: '고려대학교', department: '국제처', studentId: '2023002', visaType: 'D-4' },
                { id: 'usr003', name: '이철호', email: 'lee@example.com', university: '연세대학교', department: '국제교류팀', studentId: '2023003', visaType: 'D-2' },
                { id: 'usr004', name: '정수진', email: 'jung@example.com', university: '한양대학교', department: '국제학생팀', studentId: '2023004', visaType: 'D-2' },
                { id: 'usr005', name: '최민지', email: 'choi@example.com', university: '이화여대', department: '국제학생처', studentId: '2023005', visaType: 'D-4' },
            ];

            const studentListContainer = document.getElementById('student-list-modal');
            let selectedStudentId = null;

            function renderStudentList() {
                studentListContainer.innerHTML = '';
                mockStudents.forEach(student => {
                    const isSelected = student.id === selectedStudentId;
                    const selectedClasses = isSelected ? 'bg-indigo-100 border-indigo-500' : 'border-transparent';
                    studentListContainer.innerHTML += `
                        <div data-id="${student.id}" class="student-item p-3 border-l-4 ${selectedClasses} cursor-pointer hover:bg-slate-100 rounded-r-md">
                            <div class="grid grid-cols-2 gap-x-2 text-sm">
                                <span class="font-semibold text-slate-800">${student.name}</span>
                                <a href="user-detail.html?id=${student.id}" class="text-xs text-indigo-600 hover:underline justify-self-end">${student.id}</a>
                                <span class="text-slate-500 col-span-2">${student.email}</span>
                                <span class="text-slate-500 text-xs col-span-2">${student.university} · ${student.department}</span>
                                <span class="text-slate-500 text-xs col-span-2">${student.visaType}</span>
                            </div>
                        </div>
                    `;
                });
            }

            studentListContainer.addEventListener('click', (e) => {
                const item = e.target.closest('.student-item');
                if (item && !e.target.matches('a')) { // Prevent selection when clicking the link
                    e.preventDefault();
                    selectedStudentId = item.dataset.id;
                    renderStudentList();
                }
            });

            renderStudentList();
        });
    </script>
</body>
</html>
